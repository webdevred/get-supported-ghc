name: Test Get Supported GHC Version Action

on:
  push:
    branches: [master]
  pull_request:
  schedule:
    - cron: 0 5 * * 0  # every sunday 05:00 UTC

jobs:
  integration-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4.2.2
      - name: Check formatting with js-beautify
        run: |
          npx js-beautify -r -n "**/*.js"
          npx js-beautify -r -n "package.json"
          git diff --exit-code
      - run: npm install
      - run: npm run build
      - name: Run action with inclusive upper bound
        uses: ./
        with:
          package-yaml-path: examples/package-equal-or-less-than.yaml
        id: ghc-version-inclusive
      - name: Assert output
        run: |-
          if [ "${{ steps.ghc-version-inclusive.outputs.ghc-version }}" != "9.0.1" ]; then
            exit 1
          fi
      - name: Run action with exclusive upper bound
        uses: ./
        with:
          package-yaml-path: examples/package-less-than.yaml
        id: ghc-version-exclusive
      - name: Assert output
        run: |-
          if [ "${{ steps.ghc-version-exclusive.outputs.ghc-version }}" != "8.10.7" ]; then
            exit 1
          fi
